<!DOCTYPE html>
<html>
  <body>

    <h1>Cookie Clicker!</h1>

    <div style="height:200px;">

      <img id="Baker" src="/cookie.png" onclick="addCookies()"/>

    </div>

    <button id="addAdd" onclick="moreCookiesPerClick()">Increase cookies per click</button>

    <button id="BuyGrandma" onclick="addGrandma()">Buy a Grandma!</button>

    <p id="numberOfCookies"></p>

    <p id="cookiesYouNeedToPay"></p>

    <p id="cookiesYouNeedToGet"></p>

    <p id="x5"></p>

    <p id="TMP"></p>

    <p id="howManyYouGet"></p>

    <p id="costOfGrandma"></p>

    <p id="cookiesPerGrandma"></p>

    <p id="numberOfGrandmas"></p>

    <p id="randomNumber"></p>

    <script>


//TODO: Make it so that you can find treasure chests.
var cookies = 1;
var cookiesPerClick = 1;
var cost = 2;
var add = 2
var fibonacci1 = 1;
var fibonacci2 = 0;
var currentFibonacci;
var isGrandmaRunning = 0;
var numGrandma = 0;
var grandmaCost = 1000;
var cookiesUntilUpgrade = cost - cookies;

document.getElementById("Baker").style.height='200px';
document.getElementById("addAdd").style.height='100px';
document.getElementById("BuyGrandma").style.height='100px';
document.getElementById("BuyGrandma").style.background='#000000';
document.getElementById("BuyGrandma").style.color='#000000';
document.getElementById("addAdd").style.background='#ff0000';


function getNextFibonacci() {
  currentFibonacci = fibonacci1 + fibonacci2
    fibonacci2 = fibonacci1
    fibonacci1 = currentFibonacci
    return currentFibonacci

}

function getFibonacciByNumber(num) {
  if(num == 1){
    return 0;
  }
  if(num == 2){
    return 1;
  }
  return getFibonacciByNumber(num) + getFibonacciByNumber(num-1);

}

function testChancesGrandma() {

  var randomNumberGrandma = Math.floor(Math.random()*10000)

    if (randomNumberGrandma == 2) {
      cookies = cookies * 5
        sayYouGotCookies();
    }

}

function testChances() {

  var randomNumber = Math.floor(Math.random()*1000)

    if (randomNumber == 2) {
      cookies = cookies * 5
        sayYouGotCookies();
    }

}


function sayYouGotCookies() {
  document.getElementById("x5").innerHTML = "You just got 5 times the amount of cookies!"
    document.getElementById("x5").style.color='#915e00';
  setTimeout(function(){
    document.getElementById("x5").innerHTML = ""
  }, 5000);


}



function updateDisplay() {

  //  document.getElementById("TMP").innerHTML = String()process.cwd()
  if (cookies == 1) {
    document.getElementById("numberOfCookies").innerHTML = "You have 1 cookie!"
  }
  else {
    document.getElementById("numberOfCookies").innerHTML = "You have " + cookies + " cookies!";
  }
  document.getElementById("cookiesPerGrandma").innerHTML = "You have " + numGrandma + " Grandmas!";
  document.getElementById("cookiesYouNeedToPay").innerHTML = "You need to pay " + cost + " cookies to upgrade cookies per click!";
  document.getElementById("costOfGrandma").innerHTML = "You need to pay " + grandmaCost + " cookies for a grandma!";
  document.getElementById("howManyYouGet").innerHTML = "You get " + cookiesPerClick + " cookies per click!";
  document.getElementById("addAdd").innerHTML = "Increase cookies per click <br/> You need " + (cookies - cost) +" cookies"

  if (cookies >= cost){
    document.getElementById("addAdd").style.background='#00ff00';
  }
  else{
    document.getElementById("addAdd").style.background='#ff0000';
  }



  if (cookies >= grandmaCost){
    document.getElementById("BuyGrandma").style.background='#00ff00';
  }
  else{
    document.getElementById("BuyGrandma").style.background='#000000';
  }


  if (cost > cookies) {
    document.getElementById("cookiesYouNeedToGet").innerHTML = "You need to get " + cookiesUntilUpgrade + " cookies until you can upgrade!"
  }
  else {

    document.getElementById("cookiesYouNeedToGet").innerHTML = "You can upgrade now because you have enough cookies!"

  }

}

function runGrandma() {

  setTimeout(function(){
    cookies = Math.round(cookies + (numGrandma * (cookiesPerClick * 0.01)));
    runGrandma();
    updateDisplay();
    testChancesGrandma();
  }, 100);


}

function addGrandma() {

  if (cookies >= grandmaCost) {
    if(isGrandmaRunning == 1){
      //Increase something or other
      numGrandma = numGrandma + 1
        cookies = cookies - grandmaCost;
      grandmaCost = 10000*getFibonacciByNumber(numGrandma);
    }
    else{
      runGrandma();
      isGrandmaRunning = 1
    }
    updateDisplay();

  }


}


function addCookies() {
  cookies = cookies + cookiesPerClick;
  document.getElementById("Baker").style.height='190px';
  setTimeout(function(){
    document.getElementById("Baker").style.height='200px';
  }, 100);
  updateDisplay();
  testChances();
}
function moreCookiesPerClick() {
  if (cookies >= cost) {
    cookiesPerClick = cookiesPerClick + add;

    cookies = cookies - cost;
    add = add + 2
      cost = getNextFibonacci();
    updateDisplay();

  }
}
    </script>

  </body>
</html>
